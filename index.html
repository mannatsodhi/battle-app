<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Battle</title>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#000;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont;
  overflow:hidden;
}
.hidden{display:none}

.scene{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:24px;
}

/* buttons */
button{
  background:#ff3b3b;
  border:none;
  color:#000;
  padding:14px 26px;
  border-radius:16px;
  font-size:16px;
}
button.locked{
  background:#222;
  color:#666;
}

/* home */
#home h2{margin-bottom:20px}
.card{
  width:100%;
  max-width:380px;
  border:1px solid #222;
  border-radius:18px;
  padding:18px;
}
.blur{
  filter:blur(8px);
  opacity:.4;
}

/* timer */
#timer{
  font-size:26px;
  letter-spacing:2px;
  margin:14px 0;
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro" class="scene">
  <h1>Hi.</h1>
  <p>Choose your battle.</p>
  <button onclick="enter()">Enter</button>
</div>

<!-- HOME -->
<div id="home" class="scene hidden">
  <h2>Battle Path</h2>
  <div id="homeCard"></div>
</div>

<!-- BATTLE -->
<div id="battle" class="scene hidden">
  <h2 id="battleTitle"></h2>
  <div id="timer">00:00:00</div>
  <p>Time never pauses.</p>
  <button onclick="giveUp()">Give up</button>
</div>

<!-- RESULT -->
<div id="result" class="scene hidden">
  <h2 id="resultTitle"></h2>
  <p id="resultText"></p>
  <button onclick="goHome()">Continue</button>
</div>

<script>
/* ===== DATA ===== */
const battles=[
 {id:"soldier",name:"Soldiers",hrs:0.5},
 {id:"inosuke",name:"Inosuke",hrs:2},
 {id:"zenitsu",name:"Zenitsu",hrs:2},
 {id:"rengoku",name:"Rengoku",hrs:5},
 {id:"sanemi",name:"Sanemi",hrs:6},
 {id:"toji",name:"Toji",hrs:8},
 {id:"koku",name:"Kokushibo",hrs:11},
 {id:"dkoku",name:"Demon Kokushibo",hrs:13},
 {id:"yori",name:"Evil Yoriichi",hrs:16},
 {id:"secret",name:"???",hrs:16,hidden:true}
];

let state = JSON.parse(localStorage.getItem("battle_state") || "{}");
if(!state.done) state.done={};
state.active=null; // HARD RULE: never resume battle automatically

/* ===== SCENE CONTROL ===== */
function show(id){
  ["intro","home","battle","result"].forEach(s=>{
    document.getElementById(s).classList.add("hidden");
  });
  document.getElementById(id).classList.remove("hidden");
}

/* ===== INTRO ===== */
function enter(){
  show("home");
  renderHome();
}

/* ===== HOME ===== */
function renderHome(){
  const cardBox=document.getElementById("homeCard");
  cardBox.innerHTML="";

  let index=0;
  while(battles[index] && state.done[battles[index].id]) index++;

  const current=battles[index];
  const next=battles[index+1];

  // current
  const c=document.createElement("div");
  c.className="card";
  const btn=document.createElement("button");
  btn.textContent=`${current.name} (${current.hrs}h)`;
  btn.onclick=()=>startBattle(current);
  c.appendChild(btn);
  cardBox.appendChild(c);

  // next (blurred)
  if(next && !next.hidden){
    const n=document.createElement("div");
    n.className="card blur";
    n.textContent="???";
    cardBox.appendChild(n);
  }
}

/* ===== BATTLE ===== */
let interval=null;
function startBattle(b){
  state.active={
    id:b.id,
    end:Date.now()+b.hrs*3600000
  };
  localStorage.setItem("battle_state",JSON.stringify(state));

  document.getElementById("battleTitle").textContent=b.name;
  show("battle");

  clearInterval(interval);
  interval=setInterval(()=>{
    const left=state.active.end-Date.now();
    if(left<=0){
      clearInterval(interval);
      win();
      return;
    }
    document.getElementById("timer").textContent=format(left);
  },1000);
}

function format(ms){
  let s=Math.floor(ms/1000);
  const h=String(Math.floor(s/3600)).padStart(2,"0");
  s%=3600;
  const m=String(Math.floor(s/60)).padStart(2,"0");
  const sec=String(s%60).padStart(2,"0");
  return `${h}:${m}:${sec}`;
}

/* ===== RESULT ===== */
function win(){
  state.done[state.active.id]=true;
  state.active=null;
  localStorage.setItem("battle_state",JSON.stringify(state));
  document.getElementById("resultTitle").textContent="DEFEATED.";
  document.getElementById("resultText").textContent="You moved forward.";
  show("result");
}

function giveUp(){
  state.active=null;
  localStorage.setItem("battle_state",JSON.stringify(state));
  document.getElementById("resultTitle").textContent="DEFEAT.";
  document.getElementById("resultText").textContent="You werenâ€™t ready.";
  show("result");
}

function goHome(){
  show("home");
  renderHome();
}

/* ===== BOOT ===== */
show("intro");
</script>

</body>
</html>

